---
name: istio-ingressgateway

replicaCount: 2
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80

resources:
  requests:
    cpu: 200m
    memory: 256Mi
  limits:
    cpu: 2000m
    memory: 1Gi

podDisruptionBudget:
  minAvailable: 1

service:
  type: LoadBalancer
  annotations:
    # Cloudflare proxy handles TLS termination at edge
    # Use proxy protocol if Cloudflare is in proxy mode
    external-dns.alpha.kubernetes.io/hostname: "*.${CLUSTER_DOMAIN}"
    external-dns.alpha.kubernetes.io/external: "true"
    external-dns.alpha.kubernetes.io/cloudflare-proxied: "true"
  ports:
    - name: http2
      port: 80
      protocol: TCP
      targetPort: 8080
    - name: https
      port: 443
      protocol: TCP
      targetPort: 8443

topologySpreadConstraints:
  - maxSkew: 1
    topologyKey: topology.kubernetes.io/zone
    whenUnsatisfiable: ScheduleAnyway
    labelSelector:
      matchLabels:
        app: istio-ingressgateway

nodeSelector:
  kubernetes.io/os: linux

tolerations:
  - key: "CriticalAddonsOnly"
    operator: "Exists"

securityContext:
  runAsUser: 1337
  runAsGroup: 1337
  runAsNonRoot: true
  fsGroup: 1337

containerSecurityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true

labels:
  app: istio-ingressgateway
  istio: ingressgateway
